```{r}
#| label: setup
#| include: false

library(here)

here("R", ".setup.R") |> source()
```

<!-- badges: start -->
[![Project Status: Active – The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![License: GPLv3](https://img.shields.io/badge/license-GPLv3-bd0000.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![License: CC BY-NC-SA 4.0](https://img.shields.io/badge/license-CC_BY--NC--SA_4.0-lightgrey.svg)](https://creativecommons.org/licenses/by-nc-sa/4.0/)
[![Contributor Covenant 3.0 code of conduct badge](https://img.shields.io/badge/Contributor%20Covenant-3.0-4baaaa.svg)](https://www.contributor-covenant.org/version/3/0/code_of_conduct/)
<!-- badges: end -->

## Overview

This report showcases the brand identity of the Center for Metropolitan Studies ([CEM](https://centrodametropole.fflch.usp.br/)) and demonstrates the application of its [`brand.yml`](https://posit-dev.github.io/brand-yml/) configuration.

Since the current CEM logo lacks consistency and color balance, the visual identity was designed based on CEM's [20-Year Commemorative Logo](https://github.com/cem-usp/brand-yml/blob/main/images/logo-cem-20.png).

The CEM brand files can be found in the `brands` folder in the [`.github`](https://github.com/cem-usp/.github) repository.

## `brand.yml` Configuration

::: {.callout-important}
This file may have been updated. Please check the [`.github`](https://github.com/cem-usp/.github) repository for the latest version.
:::

<!-- %:::% brand.yml begin %:::% -->
``` {.yml filename="brand.yml"}
meta:
  name:
    short: CEM
    full: Center for Metropolitan Studies
  link:
    home: https://centrodametropole.fflch.usp.br
    github: https://github.com/cem-usp
    instagram: https://www.instagram.com/centrodametropole
    x: https://x.com/CEM_CMS
    facebook: https://www.facebook.com/CemCepid
    youtube: https://www.youtube.com/@CentrodeEstudosdaMetropole
    linkedin: https://www.linkedin.com/company/centro-de-estudos-da-metropole
  description: |
    The Center for Metropolitan Studies (CEM_ is one of the Research,
    Innovation, and Dissemination Centers (CEPIDs) of the São Paulo Research
    Foundation (FAPESP). It is based at the School of Philosophy, Letters and
    Human Sciences (FFLCH) of the University of São Paulo (USP) and at the
    Brazilian Center for Analysis and Planning (CEBRAP).
  founded: 2000

color:
  palette:
    blue: "#014691"
    gray: "#868489"
    white: "#ffffff"
    black: "#141414"
    mono-blue-1: "#14273a" # https://color.adobe.com/create/color-wheel
    mono-blue-2: "#123b64"
    mono-blue-3: "#01478f"
    mono-blue-4: "#82c1ff"
    mono-blue-5: "#add6ff"
    mono-blue-6: "#d7ebff"
    comp-blue-1: "#8f5a01" # https://color.adobe.com/create/color-wheel
    comp-blue-2: "#123b64"
    comp-blue-3: "#01488f"
    comp-blue-4: "#5c4113"
    comp-blue-5: "#14273a"
    comp-blue-6: "#f5bf64"
    triad-blue-olive: "#7f9101" # https://color.adobe.com/create/color-wheel
    triad-blue-red: "#910c01"
    triad-blue-blue: "#014791"
    square-blue-green: "#1d8f01" # https://color.adobe.com/create/color-wheel
    square-blue-orange: "#8f5a01"
    square-blue-blue: "#01488f"
    square-blue-purple: "#8f0170"
    blue-d50: "#002554" # colorspace::darken("#014691", 0.50)
    blue-l25: "#4f70b7"
    gray-l50: "#c1bfc4" # colorspace::lighten("#868489", 0.50)
    gray-l75: "#b9b9b9"
    gray-l90: "#e2e2e2"
    gray-l95: "#f1f1f1"
  background: white
  primary: blue
  secondary: gray
  tertiary: black
  success: square-blue-green
  info: square-blue-blue
  warning: square-blue-orange
  danger: triad-blue-red
  light: white
  dark: black

typography:
  fonts:
    - family: Montserrat
      source: google
    - family: Roboto
      source: google
    - family: Roboto Mono
      source: google
  base:
    family: Roboto
    line-height: 1.5
    weight: normal
  headings:
    family: Montserrat
    color: blue
    line-height: 1.25
    weight: 800
  monospace: Roboto Mono
  monospace-inline:
    color: comp-blue-1
    background-color: gray-l95
  monospace-block:
    background-color: gray-l95
  link:
    color: comp-blue-1
    decoration: none
```
<!-- %:::% brand.yml end %:::% -->

## Set the Environment

### Load Packages

```{r}
#| code-fold: false
#| output: false

library(brandr)
library(dplyr)
library(geobr)
library(ggplot2)
library(ggspatial)
library(here)
library(htmltools)
library(palmerpenguins)
library(sf)
library(tidyr)
```

## Bar Plots

```{r}
penguins |>
  ggplot(
    aes(
      x = sex,
      fill = species
    )
  ) +
  geom_bar(alpha = 0.8) +
  facet_wrap(vars(species), ncol = 1) +
  scale_fill_brand_d() +
  coord_flip() +
  labs(
    x = "Island",
    y = "Frequency",
    fill = "Species"
  )
```

## Histograms

```{r}
penguins |>
  drop_na(
    flipper_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = flipper_length_mm,
      fill = species
    )
  ) +
  geom_histogram(
    bins = 30,
    alpha = 0.5,
    position = "identity"
  ) +
  scale_fill_brand_d() +
  labs(
    x = "Flipper Length (mm)",
    y = "Frequency",
    fill = "Species"
  )
```

## Boxplots

```{r}
penguins |>
  drop_na(
    bill_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = species,
      y = bill_length_mm,
      fill = species
    )
  ) +
  geom_boxplot(
    outlier.color = get_brand_color("dark-red")
  ) +
  geom_jitter(
    width = 0.2,
    alpha = 0.1
  ) +
  scale_fill_brand_d(alpha = 0.7) +
  labs(
    x = "Species",
    y = "Bill Length (mm)",
    fill = "Species"
  )
```

## Density

```{r}
penguins |>
  drop_na(
    flipper_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = flipper_length_mm,
      fill = species
    )
  ) +
  geom_density(
    alpha = 0.5,
    position = "identity"
  ) +
  scale_fill_brand_d() +
  labs(
    x = "Flipper Length (mm)",
    y = "Density",
    fill = "Species"
  ) +
  theme(
    legend.position = "none"
  )
```

## Scatterplots

```{r}
penguins |>
  drop_na(
    body_mass_g,
    flipper_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = body_mass_g,
      y = flipper_length_mm,
      color = species,
      shape = species
    )
  ) +
  geom_point(size = 2) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  scale_color_brand_d(alpha = 0.7) +
  labs(
    x = "Body Mass (g)",
    y = "Flipper Length (mm)",
    color = "Species",
    shape = "Species"
  )
```

## Maps

```{r}
#| output: false

brazil_states <- read_state()
```

```{r}
#| output: false

data <-
  brazil_states |>
  mutate(
    n = sample(
      1:1000,
      size = n(),
      replace = TRUE
    ),
  )
```

```{r}
plot <-
  data |>
  ggplot() +
  geom_sf(
    aes(fill = n),
    color = get_brand_color("gray")
  ) +
  scale_fill_brand_b(
    n.breaks = 6
  ) +
  labs(fill = NULL) +
  annotation_scale(
    location = "br",
    style = "tick",
    width_hint = 0.25,
    height = unit(0.15, "cm")
  ) +
  annotation_north_arrow(
    location = "br",
    height = unit(2, "lines"),
    width = unit(2, "lines"),
    pad_x = unit(0.25, "lines"),
    pad_y = unit(1.25, "lines"),
    style = north_arrow_fancy_orienteering
  )
```

### Continuous

```{r}
#| messages: false
#| #| warning: false

plot
```

### Diverging

```{r}
#| messages: false
#| #| warning: false

plot +
  scale_fill_brand_b(
    color_type = "div",
    n.breaks = 6
  )
```

## Logo Pattern

::: {.callout-important}
See the [`logo-pattern`](https://cem-usp.github.io/logo-pattern/) repository to learn how to create these patterns.
:::

::: {style="text-align: center;"}
![](images/logo-pattern-animation.gif){width="80%"}
:::

## License

::: {style="text-align: left;"}
[![License: GPLv3](https://img.shields.io/badge/license-GPLv3-bd0000.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![License: CC BY-NC-SA 4.0](https://img.shields.io/badge/license-CC_BY--NC--SA_4.0-lightgrey.svg)](https://creativecommons.org/licenses/by-nc-sa/4.0/)
:::

The code in this report is licensed under the [GNU General Public License Version 3](https://www.gnu.org/licenses/gpl-3.0), while the report is available under the [Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International](https://creativecommons.org/licenses/by-nc-sa/4.0/) license.

``` text
Copyright (C) 2026 Center for Metropolitan Studies

The code in this report is free software: you can redistribute it and/or
modify it under the terms of the GNU General Public License as published by the
Free Software Foundation, either version 3 of the License, or (at your option)
any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with
this program. If not, see <https://www.gnu.org/licenses/>.
```

## Acknowledgments

```{r, results='asis'}
#| eval: true
#| echo: false

blocks <- list(
  list(
    logo_link = "https://centrodametropole.fflch.usp.br",
    logo_src = "images/cem-logo.svg",
    logo_alt = "CEM Logo",
    logo_max_width = 190,
    text = 'This work was developed with support from the Center for Metropolitan Studies (<a href="https://centrodametropole.fflch.usp.br">CEM</a>) based at the School of Philosophy, Letters and Human Sciences (<a href="https://www.fflch.usp.br/">FFLCH</a>) of the University of São Paulo (<a href="https://usp.br">USP</a>) and at the Brazilian Center for Analysis and Planning (<a href="https://cebrap.org.br/">CEBRAP</a>).'
  ),
  list(
    logo_link = "https://fapesp.br",
    logo_src = "images/fapesp-logo.svg",
    logo_alt = "FAPESP Logo",
    logo_max_width = 160,
    text = 'This work was financed, in part, by the São Paulo Research Foundation (<a href="https://fapesp.br/">FAPESP</a>), Brazil. Process Number <a href="https://bv.fapesp.br/en/bolsas/231507/geospatial-data-science-applied-to-food-policies/">2025/17879-2</a>.'
  )
)

blocks |>
  lapply(
    function(x) {
      div(
        style = paste0(
          "display: flex; ",
          "align-items: center; ",
          "margin-bottom: 2em;"
        ),
        div(
          style = paste0(
            "flex: 0 0 30%; ",
            "display: flex; ",
            "justify-content: center; ",
            "margin: auto 0;"
          ),
          tags$a(
            href = x$logo_link,
            tags$img(
              src = x$logo_src,
              alt = x$logo_alt,
              style = paste0(
                "max-width: ",
                x$logo_max_width,
                "px; ",
                "width: 100%; ",
                "height: auto;"
              )
            )
          )
        ),
        div(
          style = paste0(
            "flex: 1; ",
            "padding-left: 1em;"
          ),
          HTML(x$text)
        )
      )
    }
  ) |>
  tagList() |>
  browsable()
```
